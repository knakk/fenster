<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>{{if .Title}}{{.Title}}{{else}}{{.URI}}{{end}}</title>
  <meta name="description" content="RDF quad-store frontend">
  <meta name="author" content="Knakk!">

  <link rel="stylesheet" href="/css/styles.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
</head>

<body>

  <div id="container">
    {{if .Title}}
      <h2 class="gray wordwrap">{{.Title}}</h2>
    {{end}}
    <h2 class="wordwrap">&lt;{{.URI}}&gt;</h2>

    <ul>
    {{range .Images}}
      <li class="image"><img src="{{.}}" alt="{{.}}" title="{{.}}"></li>
    {{end}}
    </ul>
    <div class="clearfix"></div>

    <h3 class="wordwrap"><span class="black">&lt;{{.URI}}&gt;</span> as subject ({{.AsSubjectSize}}{{if gt .MaxSubject .AsSubjectSize}} of {{.MaxSubject}}{{end}})</h3>

    <table class="quads" class="wordwrap">
    <thead>
      <tr>
        <th data-sort="string" class="td-graph"><div class="th-header">GRAPH</div></th>
        <th data-sort="string" class="td-pred"><div class="th-header">PREDICATE</div></th>
        <th data-sort="string" class="td-obj"><div class="th-header">OBJECT</div></th>
      </tr>
    </thead>
    <tbody>
    {{range $el := .AsSubject}}
      <tr>
        <td class="td-graph">{{$el.g}}</td>
        <td class="td-pred">{{$el.p}}</td>
        <td class="td-obj">{{$el.o}}</td>
      </tr>
    {{end}}
    </tbody>
    </table>


    <h3 class="wordwrap"><span class="black">&lt;{{.URI}}&gt;</span> as object ({{.AsObjectSize}}{{if gt .MaxObject .AsObjectSize}} of {{.MaxObject}}{{end}})</h3>
    <table class="quads">
    <thead>
      <tr>
        <th data-sort="string" class="td-graph"><div class="th-header">GRAPH</div></th>
        <th data-sort="string" class="td-subj"><div class="th-header">SUBJECT</div></th>
        <th data-sort="string" class="td-pred"><div class="th-header">PREDICATE</div></th>
      </tr>
    </thead>
    <tbody>
    {{range $el := .AsObject}}
      <tr>
        <td class="td-graph">{{$el.g}}</td>
        <td class="td-subj">{{$el.s}}</td>
        <td class="td-pred">{{$el.p}}</td>
      </tr>
    {{end}}
    </tbody>
    </table>

  </div>
  <script>
  (function(d){d.fn.stupidtable=function(b){return this.each(function(){var a=d(this);b=b||{};b=d.extend({},d.fn.stupidtable.default_sort_fns,b);a.on("click","th",function(){var n=a.children("tbody").children("tr"),e=d(this),j=0,m=d.fn.stupidtable.dir;a.find("th").slice(0,e.index()).each(function(){var a=d(this).attr("colspan")||1;j+=parseInt(a,10)});var l=e.data("sort-dir")===m.ASC?m.DESC:m.ASC,p=l==m.DESC?e.data("sort-desc")||e.data("sort")||null:e.data("sort")||null;null!==p&&(a.trigger("beforetablesort",
{column:j,direction:l}),a.css("display"),setTimeout(function(){var k=[],c=b[p];n.each(function(a,b){var c=d(b).children().eq(j),e=c.data("sort-value"),c="undefined"!==typeof e?e:c.text();k.push(c)});var f=[],g=0;if(e.data("sort-dir")&&!e.data("sort-desc"))for(c=k.length-1;0<=c;c--)f.push(c);else for(var h=k.slice(0).sort(c),c=0;c<k.length;c++){for(g=d.inArray(k[c],h);-1!=d.inArray(g,f);)g++;f.push(g)}a.find("th").data("sort-dir",null).removeClass("sorting-desc sorting-asc");e.data("sort-dir",l).addClass("sorting-"+
l);g=n.slice(0);for(h=c=0;h<f.length;h++)c=f[h],g[c]=n[h];f=d(g);a.children("tbody").append(f);a.trigger("aftertablesort",{column:j,direction:l});a.css("display")},10))})})};d.fn.stupidtable.dir={ASC:"asc",DESC:"desc"};d.fn.stupidtable.default_sort_fns={"int":function(b,a){return parseInt(b,10)-parseInt(a,10)},"float":function(b,a){return parseFloat(b)-parseFloat(a)},string:function(b,a){return b<a?-1:b>a?1:0},"string-ins":function(b,a){b=b.toLowerCase();a=a.toLowerCase();return b<a?-1:b>a?1:0}}})(jQuery); // http://joequery.github.io/Stupid-Table-Plugin/

    $("document").ready(function() {
      $("table").each(function() {
        var l = $(this).prop('rows').length -2;
        // don't make sortable tables with 1 row, or tables with more than 500 rows
        if ( l > 1 && l < 501) {
          $(this).find('th').addClass("sortable");
          $(this).stupidtable();
        }
      });
    });

    var fetchLiterals = function( event ) {
      var el = event.target;
      var uri = el.innerHTML.substr(4, el.innerHTML.length-8);
      var target = el.nextSibling.querySelector(".literals");

      req = new XMLHttpRequest();
      req.open('GET','/literals?uri='+encodeURIComponent(uri), true);

      req.onload = function() {
        if (req.status == 200) {
          target.innerHTML = req.responseText;
          el.removeEventListener("mouseover", fetchLiterals);
        } else {
          target.innerHTML = "error fetching resource literals";
        }
      }

      req.onerror = function() {
          target.innerHTML = "server unavailable";
          el.removeEventListener("mouseover", fetchLiterals);
      };

      req.send();
    }
    var resourceLinks = document.querySelectorAll(".resource-link");
    Array.prototype.forEach.call(resourceLinks, function( el, i ) {
      el.addEventListener("mouseover", fetchLiterals);
    });


  </script>
  <footer>
    <p>Generated using the SPARQL endpoint at <a href="{{.Endpoint}}">http://data.deichman.no/sparql</a>. Get the raw data from this page as: <a href="{{.URI}}.json">JSON</a> or <a href="{{.URI}}.rdf">Turtle/TriG</a>.<br/> The data is licensed under <a href="{{.LicenseURL}}">{{.License}}</a>.</p>
    <p><strong>{{.Name}}</strong> version {{.Version}} by <a href="https://github.com/knakk">Knakk! technologies</a></p>
  </footer>
</body>
</html>
